{% extends "base.html" %}

{% block title %}B√†i t·∫≠p - {{ lesson[1] }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>üéØ B√†i t·∫≠p: {{ lesson[1] }}</h2>
    <a href="{{ url_for('lesson_detail', lesson_id=lesson[0]) }}" class="btn btn-secondary mb-4">‚Üê Quay l·∫°i kh√≥a h·ªçc</a>
    
    <div class="row">
        <div class="col-md-8">
            <!-- B√†i t·∫≠p -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üìù ƒê·ªÅ b√†i</h5>
                </div>
                <div class="card-body">
                    <p>{{ lesson[4] }}</p>
                </div>
            </div>
            
            <!-- Code editor -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üíª Vi·∫øt code</h5>
                </div>
                <div class="card-body">
                    <textarea id="exercise-code" class="form-control" rows="8" placeholder="# Vi·∫øt code c·ªßa b·∫°n ·ªü ƒë√¢y..."></textarea>
                    <br>
                    <button class="btn btn-primary" onclick="runExercise()">‚ñ∂ Ch·∫°y th·ª≠</button>
                    <button class="btn btn-info ms-2" onclick="showHint()">üí° Xem g·ª£i √Ω</button>
                    <button class="btn btn-warning ms-2" onclick="showSolution()">üîë Xem l·ªùi gi·∫£i</button>
                </div>
            </div>
            
            <!-- G·ª£i √Ω -->
            <div id="hint-section" class="card mb-4" style="display: none;">
                <div class="card-header">
                    <h5>üí° G·ª£i √Ω</h5>
                </div>
                <div class="card-body">
                    <p id="hint-text"></p>
                    <button class="btn btn-secondary" onclick="hideHint()">·∫®n g·ª£i √Ω</button>
                </div>
            </div>
            
            <!-- L·ªùi gi·∫£i -->
            <div id="solution-section" class="card mb-4" style="display: none;">
                <div class="card-header">
                    <h5>üîë L·ªùi gi·∫£i</h5>
                </div>
                <div class="card-body">
                    <pre id="solution-code" style="background: #f8f9fa; padding: 10px; color: black;"></pre>
                    <button class="btn btn-secondary" onclick="hideSolution()">·∫®n l·ªùi gi·∫£i</button>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- K·∫øt qu·∫£ -->
            <div class="card">
                <div class="card-header">
                    <h6>üìä K·∫øt qu·∫£</h6>
                </div>
                <div class="card-body">
                    <pre id="output" style="background: #f8f9fa; padding: 10px; min-height: 200px; color: black;"></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function runExercise() {
    const code = document.getElementById('exercise-code').value;
    fetch('/run_code', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({code: code})
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('output').textContent = data.success ? data.output : data.error;
    });
}



function showHint() {
    fetch('/get_solution/{{ lesson[0] }}')
    .then(response => response.json())
    .then(data => {
        if (data.explanation) {
            document.getElementById('hint-text').textContent = data.explanation;
            document.getElementById('hint-section').style.display = 'block';
        } else {
            alert('Ch∆∞a c√≥ g·ª£i √Ω cho b√†i n√†y');
        }
    });
}

function hideHint() {
    document.getElementById('hint-section').style.display = 'none';
}

function showSolution() {
    fetch('/get_solution/{{ lesson[0] }}')
    .then(response => response.json())
    .then(data => {
        if (data.solution) {
            document.getElementById('solution-code').textContent = data.solution;
            document.getElementById('solution-section').style.display = 'block';
        } else {
            alert('Ch∆∞a c√≥ l·ªùi gi·∫£i cho b√†i n√†y');
        }
    });
}

function hideSolution() {
    document.getElementById('solution-section').style.display = 'none';
}
</script>
{% endblock %}