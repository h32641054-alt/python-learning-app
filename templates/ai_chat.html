{% extends "base.html" %}

{% block title %}AI Tr·ª£ l√Ω Python - Python Learning{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h3>ü§ñ AI Tr·ª£ l√Ω Python</h3>
                <p class="mb-0">H·ªèi b·∫•t k·ª≥ c√¢u h·ªèi n√†o v·ªÅ Python, t√¥i s·∫Ω gi√∫p b·∫°n!</p>
            </div>
            <div class="card-body">
                <div id="chat-messages" class="mb-3" style="height: 400px; overflow-y: auto; border: 1px solid #dee2e6; padding: 15px; border-radius: 5px;">
                    <div class="message ai-message" style="color: #000000;">
                        <strong style="color: #000000;">ü§ñ AI:</strong> <span style="color: #000000;">Xin ch√†o! T√¥i l√† tr·ª£ l√Ω AI c·ªßa Python Learning. T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:
                        <ul style="color: #000000;">
                            <li>Gi·∫£i th√≠ch c√°c kh√°i ni·ªám Python</li>
                            <li>Debug code</li>
                            <li>G·ª£i √Ω c√°ch gi·∫£i b√†i t·∫≠p</li>
                            <li>Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ l·∫≠p tr√¨nh</li>
                        </ul>
                        H√£y h·ªèi t√¥i b·∫•t k·ª≥ ƒëi·ªÅu g√¨ v·ªÅ Python!</span>
                    </div>
                </div>
                
                <div class="input-group">
                    <input type="text" id="user-input" class="form-control" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." onkeypress="handleKeyPress(event)">
                    <button class="btn btn-success" onclick="sendMessage()">G·ª≠i</button>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üí° C√¢u h·ªèi g·ª£i √Ω</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <button class="list-group-item list-group-item-action" onclick="askQuestion('Python l√† g√¨?')">
                                Python l√† g√¨?
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="askQuestion('Bi·∫øn trong Python')">
                                Bi·∫øn trong Python ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o?
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="askQuestion('V√≤ng l·∫∑p for')">
                                C√°ch s·ª≠ d·ª•ng v√≤ng l·∫∑p for
                            </button>
                            <button class="list-group-item list-group-item-action" onclick="askQuestion('H√†m trong Python')">
                                C√°ch t·∫°o h√†m trong Python
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üéØ Tips s·ª≠ d·ª•ng AI</h5>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li>H·ªèi c√¢u h·ªèi c·ª• th·ªÉ v√† r√µ r√†ng</li>
                            <li>Chia s·∫ª code n·∫øu c·∫ßn debug</li>
                            <li>M√¥ t·∫£ v·∫•n ƒë·ªÅ b·∫°n g·∫∑p ph·∫£i</li>
                            <li>H·ªèi v·ªÅ best practices</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function sendMessage() {
    const input = document.getElementById('user-input');
    const sendBtn = document.querySelector('.btn-success');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Disable button and show loading
    sendBtn.disabled = true;
    sendBtn.classList.add('loading');
    sendBtn.textContent = 'ƒêang g·ª≠i...';
    
    // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
    addMessage('user', message);
    input.value = '';
    
    // G·ª≠i tin nh·∫Øn ƒë·∫øn AI
    fetch('/chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({message: message})
    })
    .then(response => response.json())
    .then(data => {
        addMessage('ai', data.response);
    })
    .catch(error => {
        addMessage('ai', 'Xin l·ªói, c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!');
    })
    .finally(() => {
        // Re-enable button
        sendBtn.disabled = false;
        sendBtn.classList.remove('loading');
        sendBtn.textContent = 'G·ª≠i';
    });
}

function addMessage(sender, message) {
    const chatMessages = document.getElementById('chat-messages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message mb-3`;
    
    if (sender === 'user') {
        messageDiv.innerHTML = `<strong style="color: #000000;">üë§ B·∫°n:</strong> <span style="color: #000000;">${message}</span>`;
        messageDiv.style.textAlign = 'right';
        messageDiv.style.backgroundColor = '#e3f2fd';
        messageDiv.style.padding = '10px';
        messageDiv.style.borderRadius = '10px';
        messageDiv.style.marginLeft = '20%';
        messageDiv.style.color = '#000000';
    } else {
        messageDiv.innerHTML = `<strong style="color: #000000;">ü§ñ AI:</strong> <span style="color: #000000;">${message}</span>`;
        messageDiv.style.backgroundColor = '#f1f8e9';
        messageDiv.style.padding = '10px';
        messageDiv.style.borderRadius = '10px';
        messageDiv.style.marginRight = '20%';
        messageDiv.style.color = '#000000';
    }
    
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function handleKeyPress(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}

function askQuestion(question) {
    document.getElementById('user-input').value = question;
    sendMessage();
}
</script>
{% endblock %}